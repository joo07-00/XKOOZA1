<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XKOOZA Checkout - Secure Shopping Cart | Egyptian Streetwear</title>
    <meta name="description" content="Complete your XKOOZA streetwear purchase securely. Multiple payment options available including Vodafone Cash and Cash on Delivery. Fast shipping across Egypt with real-time order tracking.">
    <meta name="keywords" content="XKOOZA checkout, Egyptian streetwear shopping, secure payment Egypt, Vodafone Cash, Cash on Delivery">
    
    <!-- Google Analytics with performance optimizations -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google-analytics.com">
    
    <!-- Google tag (gtag.js) with async -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QZHPB9RD6D"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // Configure analytics with additional settings
        gtag('config', 'G-QZHPB9RD6D', {
            'anonymize_ip': true,
            'page_title': document.title,
            'page_path': window.location.pathname,
            'send_page_view': true
        });
    </script>

    <!-- External Libraries -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/logo.png">         
    <link rel="canonical" href="https://xkooza.netlify.app/checkout" />
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "CheckoutPage",
        "name": "XKOOZA Checkout",
        "description": "Complete your XKOOZA streetwear purchase",
        "url": "https://xkooza.netlify.app/checkout",
        "provider": {
            "@type": "Organization",
            "name": "XKOOZA"
        },
        "acceptedPaymentMethod": [
            {
                "@type": "PaymentMethod",
                "name": "Cash on Delivery",
                "termsOfService": "Payment on delivery at your address"
            },
            {
                "@type": "PaymentMethod",
                "name": "Vodafone Cash",
                "termsOfService": "Instant mobile payment through Vodafone Cash service"
            }
        ],
        "shippingDetails": {
            "@type": "OfferShippingDetails",
            "shippingRate": {
                "@type": "MonetaryAmount",
                "value": "90.00",
                "currency": "EGP"
            },
            "deliveryTime": {
                "@type": "ShippingDeliveryTime",
                "businessDays": {
                    "@type": "OpeningHoursSpecification",
                    "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
                }
            }
        },
        "sameAs": [
            "https://www.instagram.com/_xkooza?igsh=bHJmd3FwajY0cmhr",
            "https://www.tiktok.com/@x.kooza?_t=ZS-8usVJyeQSXg&_r=1",
            "https://www.facebook.com/share/19wx7EieiN/"
        ]
    }
    </script>

    <!-- Facebook Specific -->
    <meta property="fb:app_id" content="your_fb_app_id">
    <meta property="article:author" content="https://www.facebook.com/share/19wx7EieiN/">
    <meta property="article:publisher" content="https://www.facebook.com/share/19wx7EieiN/">

    <!-- Instagram and TikTok -->
    <meta property="og:see_also" content="https://www.instagram.com/_xkooza?igsh=bHJmd3FwajY0cmhr">
    <meta property="og:see_also" content="https://www.tiktok.com/@x.kooza?_t=ZS-8usVJyeQSXg&_r=1">

    <!-- Pinterest Verification -->
    <meta name="p:domain_verify" content="your_pinterest_verification_code">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <button class="hamburger">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        <a href="index.html" class="nav-logo">XKOOZA</a>
        <div class="nav-links">
            <a href="index.html" >Home</a>
            <a href="collections.html">Collections</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
        </div>
        <div class="mobile-nav-links">
            <a href="index.html" >Home</a>
            <div class="mobile-menu-item">
                <a href="collections.html">Collections</a>
                <div class="sub-menu">
                    <a href="last-collection.html">Latest Collection</a>
                    <a href="summer.html">Summer Collection</a>
                    <a href="winter.html">Winter Collection</a>
                </div>
            </div>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            <div class="mobile-social-links">
                <a href="https://www.instagram.com/_xkooza?igsh=bHJmd3FwajY0cmhr" class="social-icon" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-instagram"></i> Instagram
                </a>
                <a href="https://www.tiktok.com/@x.kooza?_t=ZS-8usVJyeQSXg&_r=1" class="social-icon" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-tiktok"></i> TikTok
                </a>
                <a href="https://www.facebook.com/share/19wx7EieiN/" class="social-icon" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-facebook"></i> Facebook
                </a>
            </div>
        </div>
       
        <div class="cart-icon-container">
            <a href="checkout.html" class="cart-icon">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge"></span>
            </a>
            <a href="signin.html" class="user-icon">
                <i class="fas fa-user"></i>
                <div class="user-dropdown">
                    <a href="signin.html">Sign In</a>
                    <a href="signup.html">Sign Up</a>
                </div>
            </a>
        </div>
    </nav>


    <!-- Checkout Section -->
    <section class="checkout-section">
        <div class="checkout-container">
            <h1 class="main-title">XKOOZA Checkout</h1>
                <!-- Order Summary Section -->
                <div class="order-summary" data-aos="fade-up">
                    <h2 class="section-title">Your Shopping Cart</h2>
                    <div class="cart-items">
                            <!-- Cart items will be dynamically populated -->
                    </div>
                    <div class="total-amount">
                        <div class="total" id="total-row">
                            <span>Total:</span>
                            <span class="total-price">0.00 L.E</span>
                        </div>
                    </div>
                    <button id="showFormBtn" class="checkout-btn">Checkout</button>
                </div>

            <!-- Main Form - Wraps everything -->
            <div class="checkout-form-container">
                <form id="payment-form"  
                      name="payment-form" 
                      method="POST" 
                      data-netlify="true" 
                      netlify-honeypot="bot-field"
                      enctype="multipart/form-data"
                      onsubmit="handleOrderSubmission(event)">
                  
                  <!-- Add these hidden inputs for Netlify -->
                  <input type="hidden" name="form-name" value="payment-form">
                  <input type="hidden" name="bot-field">
 
                  <!-- Shipping Information Section -->
                  <div class="form-section">
                      <h2 class="section-title">Shipping Information</h2>
                      <div class="form-group">
                          <label for="name">Full Name</label>
                          <input type="text" id="name" name="name" required>
                      </div>
                      <div class="form-group">
                          <label for="email">Email</label>
                          <input type="email" id="email" name="email" required>
                      </div>
                      <div class="form-group">
                          <label for="phone">Phone</label>
                          <input type="tel" id="phone" name="phone" required>
                      </div>
                      <div class="form-group">
                          <label for="governorate">Governorate</label>
                          <select id="governorate" name="governorate" class="form-select" required onchange="updateCities()">
                              <option value="">Select Governorate</option>
                              <option value="cairo">Cairo</option>
                              <option value="giza">Giza</option>
                              <option value="alexandria">Alexandria</option>
                              <option value="qalyubia">Qalyubia</option>
                              <option value="daqahlia">Dakahlia</option>
                              <option value="sharqia">Sharqia</option>
                              <option value="gharbia">Gharbia</option>
                              <option value="monufia">Monufia</option>
                              <option value="beheira">Beheira</option>
                              <option value="kafr-el-sheikh">Kafr El Sheikh</option>
                              <option value="fayoum">Fayoum</option>
                              <option value="beni-suef">Beni Suef</option>
                              <option value="minya">Minya</option>
                              <option value="assiut">Assiut</option>
                              <option value="sohag">Sohag</option>
                              <option value="qena">Qena</option>
                              <option value="luxor">Luxor</option>
                              <option value="aswan">Aswan</option>
                              <option value="red-sea">Red Sea</option>
                              <option value="new-valley">New Valley</option>
                              <option value="matrouh">Matrouh</option>
                              <option value="north-sinai">North Sinai</option>
                              <option value="south-sinai">South Sinai</option>
                              <option value="ismailia">Ismailia</option>
                              <option value="port-said">Port Said</option>
                              <option value="suez">Suez</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label for="city">City</label>
                          <select id="city" name="city" class="form-select" required>
                              <option value="">Select Governorate First</option>
                          </select>
                      </div>
                      <div class="form-group">
                          <label for="address">Detailed Address</label>
                          <input type="text" id="address" name="address" placeholder="Building number, street name, landmark" required>
                      </div>
                  </div>

                  <!-- Payment Method Section -->
                  <div class="form-section">
                      <h2 class="section-title">Payment Options</h2>
                      <div class="payment-options">
                          <div class="payment-option">
                              <label class="payment-option-label" data-payment="cash">
                                  <i class="fas fa-money-bill"></i>
                                  Cash on Delivery
                              </label>
                          </div>
                      </div>
                  </div>

                  <!-- Hidden fields for cart data -->
                  <input type="hidden" name="cart-items" id="cart-items-input">
                  <input type="hidden" name="total-amount" id="total-amount-input">
                  <input type="hidden" name="payment-details" id="payment-details-input">

                  <!-- Submit button -->
                  <button type="submit" class="checkout-btn">Complete Order</button>
              </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
       <!-- Footer -->
       <footer>
        <div class="footer-content">
            <div class="xkooza-logo">
                <img src="assets/logo.png" alt="XKooza Logo">
            </div>
            <div class="footer-section">
                <h3>Navigation</h3>
                <div class="footer-links">
                    <a href="index.html">Home</a>
                    <a href="collections.html">Collections</a>
                    <a href="about.html">About</a>
                    <a href="contact.html">Contact</a>
                    <a href="terms.html">Terms & Conditions</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Collections</h3>
                <div class="footer-links">
                    <a href="last-collection.html">Latest Collection</a>
                    <a href="summer.html">Summer Collection</a>
                    <a href="winter.html">Winter Collection</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-links">
                    <a href="https://www.instagram.com/_xkooza?igsh=bHJmd3FwajY0cmhr" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.tiktok.com/@x.kooza?_t=ZS-8usVJyeQSXg&_r=1" class="social-icon"><i class="fab fa-tiktok"></i></a>
                    <a href="https://www.facebook.com/share/19wx7EieiN/" class="social-icon"><i class="fab fa-facebook"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 XKOOZA. All rights reserved.</p>
        </div>
    </footer>
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="script.js"></script>
    <script>
        // Initialize AOS
        AOS.init({
            duration: 1000,
            once: true
        });
    </script>
    <script>
        // Initialize cart badge
        document.addEventListener('DOMContentLoaded', () => {
            const cartIcon = document.querySelector('.cart-icon');
            if (cartIcon) {
                // Remove any existing badge first to avoid duplicates
                const existingBadge = cartIcon.querySelector('.cart-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }
                // Create and append the badge
                const badge = document.createElement('span');
                badge.className = 'cart-badge';
                cartIcon.appendChild(badge);

                // Add shopping cart icon if it doesn't exist
                if (!cartIcon.querySelector('.fas.fa-shopping-cart')) {
                    const cartIconElement = document.createElement('i');
                    cartIconElement.className = 'fas fa-shopping-cart';
                    cartIcon.insertBefore(cartIconElement, badge);
                }
            }
            
            // Update the badge
            updateCartBadge();
        });
    </script>
    <script>
        const showFormBtn = document.getElementById('showFormBtn');
        const paymentForm = document.getElementById('payment-form');

        showFormBtn.addEventListener('click', function() {
        showFormBtn.style.display = 'none'; 
        paymentForm.style.display = 'block';
        });
     </script>
    <script>
    window.addEventListener('DOMContentLoaded', function () {
        const payNowClicked = localStorage.getItem('payNowClicked');
        
        if (payNowClicked === 'true') {
            const showFormBtn = document.getElementById('showFormBtn');
            const paymentForm = document.getElementById('payment-form');
    
            if (paymentForm) {
                paymentForm.style.display = 'block'; 
            }
    
            if (showFormBtn) {
                showFormBtn.style.display = 'none'; 
            }
    
            localStorage.removeItem('payNowClicked');
        }
    });
    </script>
      
    <div class="brand-mark" id="brandMark">
        <img src="assets/logo.png" alt="XKooza Brand Mark">
    </div>

    <div class="social-menu" id="socialMenu">
        <a href="https://www.instagram.com/_xkooza?igsh=bHJmd3FwajY0cmhr" class="instagram" target="_blank">
            <i class="fab fa-instagram"></i>
        </a>
        <a href="https://www.tiktok.com/@x.kooza?_t=ZS-8usVJyeQSXg&_r=1" class="tiktok" target="_blank">
            <i class="fab fa-tiktok"></i>
        </a>
        <a href="https://www.facebook.com/share/19wx7EieiN/" class="facebook" target="_blank">
            <i class="fab fa-facebook"></i>
        </a>
    </div>

    <!-- Terms and Conditions Popup -->
    <div class="terms-popup" id="termsPopup">
        <div class="terms-content">
            <div class="terms-text">
                <p>By using this website, you agree to our Terms of Service and Privacy Policy.</p>
            </div>
            <div class="terms-buttons">
                <button id="acceptTerms" class="accept-btn">Accept</button>
                <button id="declineTerms" class="decline-btn">Decline</button>
            </div>
            <div class="terms-link">
                <a href="terms.html" target="_blank">Read our Terms & Conditions</a>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics-compat.js"></script>
    <script src="auth.js"></script>

    <div id="file-preview"></div>

    <script>
        // Handle form submission
        function handleOrderSubmission(event) {
            event.preventDefault();
            
            // Get form data
            const form = document.getElementById('payment-form');
            const name = form.querySelector('#name').value;
            const email = form.querySelector('#email').value;
            const phone = form.querySelector('#phone').value;
            const governorate = form.querySelector('#governorate').value;
            const city = form.querySelector('#city').value;
            const address = form.querySelector('#address').value;
            const paymentMethod = 'Cash on Delivery';
            
            // Show loading status
            const submitButton = form.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            }
            
            // Get cart items from localStorage (temporary solution)
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            if (cart.length === 0) {
                showToast('Your cart is empty', 'error');
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Complete Order';
                }
                return;
            }
            
            // Calculate total amount
            const totalAmount = cart.reduce((total, item) => {
                const price = parseFloat(item.price.toString().replace('L.E', '').trim());
                return total + (price * item.quantity);
            }, 0);
            
            // Generate a random 3-digit order ID
            const randomNum = Math.floor(100 + Math.random() * 900);
            const orderId = `XK-${randomNum}`;
            
            // Get current date and time in Cairo timezone
            const cairoDate = new Date().toLocaleString('en-US', {
                timeZone: 'Africa/Cairo',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            
            // Create order object
            const orderData = {
                id: orderId,
                date: cairoDate,
                items: cart,
                shippingInfo: {
                    name,
                    email,
                    phone,
                    governorate,
                    city,
                    address
                },
                paymentMethod,
                status: 'Pending',
                totalAmount: totalAmount.toFixed(2) + ' L.E'
            };
            
            // Add user ID if logged in
            const user = firebase.auth().currentUser;
            if (user) {
                orderData.userId = user.uid;
            }
            
            // Save order to Firebase
            const db = firebase.firestore();
            
            // First check if the ID already exists
            db.collection('orders').where('id', '==', orderId).get()
                .then((snapshot) => {
                    if (!snapshot.empty) {
                        // ID already exists, generate a new one with timestamp to ensure uniqueness
                        const timestamp = new Date().getTime().toString().slice(-3);
                        orderData.id = `XK-${randomNum}${timestamp}`;
                    }
                    
                    // Add the order to Firestore
                    return db.collection('orders').add(orderData);
                })
                .then(() => {
                    // Clear cart after successful order
                    localStorage.removeItem('cart');
                    
                    // Show success message
                    showToast('Order placed successfully!', 'success');
                    
                    // Redirect to thank you page with order ID
                    setTimeout(() => {
                        window.location.href = `thank-you.html?orderId=${orderData.id}`;
                    }, 1500);
                })
                .catch((error) => {
                    console.error("Error adding order: ", error);
                    showToast('Error placing order. Please try again.', 'error');
                    
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.innerHTML = 'Complete Order';
                    }
                });
        }
    </script>
</body>
</html> 